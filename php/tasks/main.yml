---
  - name: Add ondrej/php-7.0 ppa
    apt_repository: repo=ppa:ondrej/php-7.0 state=present

  - name: Install php7
    apt: name={{item}} state=installed
    with_items:
      - php7.0
      - php7.0-common
      - php7.0-fpm
      - php7.0-cli

  - name: Start php7.0-fpm
    service: name=php7.0-fpm state=started enabled=true

  - name: Install PHP dependencies
    apt: name={{item}} state=installed
    with_items: php.extensions
    notify:
      - Restart php7.0-fpm

  - name: Configure php7-cli
    template: src=php.ini.j2 dest=/etc/php5/cli/php.ini owner=root group=root mode=0644

  - name: Configure php7.0-fpm
    template: src=php.ini.j2 dest=/etc/php5/fpm/php.ini owner=root group=root mode=0644
    notify:
      - Restart php7.0-fpm

  - name: Configure php7.0-fpm pools
    template: src=php-fpm.pool.conf.j2 dest=/etc/php5/fpm/pool.d/{{item.name}}.conf owner=root group=root mode=0644
    with_items: pools
    notify:
      - Restart php7.0-fpm

  - name: Configure Xdebug
    template: src=xdebug.ini.j2 dest=/etc/php5/fpm/conf.d/20-xdebug.ini owner=root group=root mode=0644
    notify:
      - Restart php7.0-fpm

